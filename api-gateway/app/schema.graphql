scalar DateTime

schema {
    query: Query
    mutation: Mutation
}




type Message {
    id: ID!
    thread: Thread!
    user_id: ID!
    type: String
    paths: [String]
    created_at: DateTime!
    updated_at: DateTime!
    deleted_at: DateTime
}

type MessagesPage {
    items: [Message!]!
    next_cursor: String
    has_more: Boolean!
}


enum ChannelType {
    PUBLIC
    PRIVATE
}

type ChannelMember {
    id: ID!
    joined_at: DateTime!
}

input ChannelMemberInput {
    id: ID!
    joined_at: DateTime!
}

input CreateChannelInput {
    name: String!
    owner_id: String!
    users: [ChannelMemberInput!]!
    channel_type: ChannelType!
}

type Channel {
    id: ID
    name: String!
    owner_id: String!
    users: [ChannelMember!]!
    is_active: Boolean!
    channel_type: ChannelType!
    created_at: DateTime!
    updated_at: DateTime!
    deleted_at: DateTime
}

type ChannelBasicInfo {
    id: ID
    name: String!
    owner_id: String!
    channel_type: ChannelType!
    created_at: DateTime!
    user_count: Int!
}



type User {
    id: ID!
    email: String!
    username: String!
    full_name: String
    is_active: Boolean!
}

type Token {
    access_token: String!
    token_type: String!
}


type PrograChatbotReply {
    reply: String!
}

type WikipediaChatbotReply {
    message: String!
}




enum StatusEnum {
    online
    offline
}

enum DeviceEnum {
    web
    mobile
    desktop
    unknown
}

type UserPresence {
    id: ID!
    userId: ID!
    device: DeviceEnum!
    status: StatusEnum!
    connectedAt: DateTime!
    lastSeen: DateTime!
}

type DataPresenceReply {
    total_users: Int
    users: [UserPresence]
}

type GetPresenceReply {
    status: String!
    message: String!
    data: DataPresenceReply
}


type DataPresenceStatsReply {
    total: Int!
    online: Int!
    offline: Int!
}

type GetPresenceStatsReply {
    status: String!
    message: String!
    data: DataPresenceStatsReply
}

type GetPresenceUserReply {
    status: String!
    message: String!
    data: UserPresence
}


type DataRegisterPresence {
    userId: ID!
    device: DeviceEnum!
    status: StatusEnum!
    connectedAt: DateTime!
    lastSeen: DateTime!
}

type RegisterPresenceReply {
    status: String!
    message: String!
    data: DataRegisterPresence!
}

type UpdateDeletePresenceReply {
    status: String!
    message: String!
    data: String
}

type Query {
    getMessage(thread_id: String!, user_id: String!): MessagesPage!

    getChannels: [ChannelBasicInfo!]!
    getChannel(channel_id: String!): Channel!

    getUser(token: String!): User!

    getMessagePrograChatbot(message: String!): PrograChatbotReply!
    getMessageWikipediaChatbot(message: String!): WikipediaChatbotReply!

    getPresence(statusEnum: StatusEnum): GetPresenceReply!
    getPresenceStats: GetPresenceStatsReply!
    getPresenceUser(userId: String!): GetPresenceUserReply!
}

type Mutation {
    createMessage(thread_id: ID!, content: String!, type_: String!, paths: [String], user_id: String!): Message!
    updateMessage(thread_id: String!, message_id: String!, content: String!, type_: String!, paths: [String], user_id: String!): Message!
    deleteMessage(thread_id: String!, message_id: String!, user_id: String!): Boolean!

    createChannel(name: String!, owner_id: String!, users: [ChannelMemberInput!]!, channel_type: ChannelType!): Channel!
    updateChannel(channel_id: ID!, name: String!, owner_id: String!, channel_type: ChannelType!): Channel!
    deleteChannel(channel_id: ID!): ID!
    reactivateChannel(channel_id: ID!): ID!

    createUser(email: String!, username: String!, password: String!, full_name: String): User!
    updateUser(full_name: String): User!
    loginUser(username_or_email: String!, password: String!): Token!

    registerPresence(userId: String!, device: DeviceEnum, ip: String): RegisterPresenceReply!
    updatePresence(userId: String!, status: StatusEnum, heartbeat: Boolean): UpdateDeletePresenceReply!
    deletePresence(userId: String!): UpdateDeletePresenceReply!
}


type Thread {
    id: ID!
    title: String
    author_id: ID
    category: String
    tags: [String]
    content: String
    created_at: DateTime
    updated_at: DateTime
}




extend type Query {
  # HomePage -> search channels by query string
  searchChannels(
    q: String
    channel_id: ID
    owner_id: String
    channel_type: ChannelType
    is_active: Boolean
    limit: Int 
    offset: Int
    ): [Channel!]!

  # ChannelPage -> search threads within a channel using multiple optional filters.
 
  searchThreads(
    channel_id: String
    category: String
    author: String
    tag: String
    keyword: String
    start_date: DateTime
    end_date: DateTime
  ): [Thread!]!

    # ThreadPage -> search messages inside a thread
    searchMessages(thread_id: ID!, query: String): [Message!]!
}

